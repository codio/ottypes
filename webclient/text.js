!function(){var r={exports:{}},t=r.exports;t.name="text",t.uri="http://sharejs.org/types/textv1",t.create=function(r){if(null!=r&&"string"!=typeof r)throw Error("Initial data must be a string");return r||""};var e=Array.isArray||function(r){return"[object Array]"===Object.prototype.toString.call(r)},n=function(r){if(!e(r))throw Error("Op must be an array of components");for(var t=null,n=0;n<r.length;n++){var o=r[n];switch(typeof o){case"object":if(!("number"==typeof o.d&&o.d>0))throw Error("Object components must be deletes of size > 0");break;case"string":if(!(o.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(o>0))throw Error("Skip components must be >0");if("number"==typeof t)throw Error("Adjacent skip components should be combined")}t=o}if("number"==typeof t)throw Error("Op has a trailing skip")},o=function(r){return function(t){return t&&0!==t.d?0===r.length?r.push(t):typeof t==typeof r[r.length-1]?"object"==typeof t?r[r.length-1].d+=t.d:r[r.length-1]+=t:r.push(t):void 0}},s=function(r){var t=0,e=0,n=function(n,o){if(t===r.length)return-1===n?null:n;var s,i=r[t];return"number"==typeof i?-1===n||n>=i-e?(s=i-e,++t,e=0,s):(e+=n,n):"string"==typeof i?-1===n||"i"===o||i.length-e<=n?(s=i.slice(e),++t,e=0,s):(s=i.slice(e,e+n),e+=n,s):-1===n||"d"===o||i.d-e<=n?(s={d:i.d-e},++t,e=0,s):(e+=n,{d:n})},o=function(){return r[t]};return[n,o]},i=function(r){return"number"==typeof r?r:r.length||r.d},a=function(r){return r.length>0&&"number"==typeof r[r.length-1]&&r.pop(),r};t.normalize=function(r){for(var t=[],e=o(t),n=0;n<r.length;n++)e(r[n]);return a(t)},t.apply=function(r,t){if("string"!=typeof r)throw Error("Snapshot should be a string");n(t);for(var e=[],o=0,s=0;s<t.length;s++){var i=t[s];switch(typeof i){case"number":if(i>r.length)throw Error("The op is too long for this document");o=i,e.push(r.slice(0,i)),r=r.slice(i);break;case"string":e.push(i);break;case"object":h(o,i.d,r.substring(0,i.d)),r=r.slice(i.d)}}return e.join("")+r},t.transform=function(r,t,e){if("left"!=e&&"right"!=e)throw Error("side ("+e+") must be 'left' or 'right'");n(r),n(t);for(var c=[],f=o(c),u=s(r),h=u[0],p=u[1],l=0;l<t.length;l++){var b,g,d=t[l];switch(typeof d){case"number":for(b=d;b>0;)g=h(b,"i"),f(g),"string"!=typeof g&&(b-=i(g));break;case"string":"left"===e&&"string"==typeof p()&&f(h(-1)),f(d.length);break;case"object":for(b=d.d;b>0;)switch(g=h(b,"i"),typeof g){case"number":b-=g;break;case"string":f(g);break;case"object":b-=g.d}}}for(;d=h(-1);)f(d);return a(c)},t.compose=function(r,t){n(r),n(t);for(var e=[],c=o(e),f=s(r)[0],u=0;u<t.length;u++){var h,p,l=t[u];switch(typeof l){case"number":for(h=l;h>0;)p=f(h,"d"),c(p),"object"!=typeof p&&(h-=i(p));break;case"string":c(l);break;case"object":for(h=l.d;h>0;)switch(p=f(h,"d"),typeof p){case"number":c({d:p}),h-=p;break;case"string":h-=p.length;break;case"object":c(p)}}}for(;l=f(-1);)c(l);return a(e)};var c=function(r,t){for(var e=0,n=0;n<t.length;n++){var o=t[n];if(e>=r)break;switch(typeof o){case"number":if(e+o>=r)return r;e+=o;break;case"string":e+=o.length,r+=o.length;break;case"object":r-=Math.min(o.d,r-e)}}return r};t.transformCursor=function(r,t,e){var n=0;if(e){for(var o=0;o<t.length;o++){var s=t[o];switch(typeof s){case"number":n+=s;break;case"string":n+=s.length}}return[n,n]}return[c(r[0],t),c(r[1],t)]};var f=[],u=10,h=function(r,t,e){var n=f.length;n>u&&(f=f.slice(n-u,n)),f.push({hash:r+":"+t,str:e})},p=function(r,t){for(var e=r+":"+t,n=f.length-1;n>=0;n--)if(f[n].hash==e){var o=f[n].str;return f.splice(n,1),o}return""};t.invert=function(r){r=r.slice();for(var t=1;t<r.length;t+=2)r[t]=r[t]instanceof Object?p(r[t-1],r[t].d):{d:r[t].length};return{op:r}};var l=window.ottypes=window.ottypes||{},b=r.exports;l[b.name]=b,b.uri&&(l[b.uri]=b)}();